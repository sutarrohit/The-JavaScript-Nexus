# ðŸ“˜ **Aggregate Queries in SQL**

## ðŸ§© **Introduction**

**Aggregate Queries** in SQL are used to perform **calculations on multiple rows** of data and return **summarized results** â€” such as totals, averages, counts, or maximum/minimum values.

They are extremely useful for **data analysis and reporting**, allowing you to condense large datasets into meaningful summaries (for example, total sales per region, average salary per department, etc.).

These queries typically use **aggregate functions** along with **GROUP BY** and **HAVING** clauses.

## ðŸŽ¯ **Purpose**

-   To perform **mathematical and statistical operations** on table data.
-   To **summarize** and **analyze** large volumes of records.
-   To **group data** based on common values (like department, region, category).
-   To **filter aggregated results** using the `HAVING` clause.

---

## ðŸ§® **Common Aggregate Functions**

| Function    | Description                                    | Example                    |
| ----------- | ---------------------------------------------- | -------------------------- |
| **COUNT()** | Counts the number of rows (or non-null values) | `COUNT(*)` counts all rows |
| **SUM()**   | Calculates the total sum of a numeric column   | `SUM(salary)`              |
| **AVG()**   | Computes the average value of a numeric column | `AVG(price)`               |
| **MIN()**   | Finds the smallest value in a column           | `MIN(age)`                 |
| **MAX()**   | Finds the largest value in a column            | `MAX(salary)`              |

---

## ðŸ§± **Aggregate Function Syntax**

```sql
SELECT aggregate_function(column_name)
FROM table_name
WHERE condition;
```

### ðŸ§  **Example:**

```sql
SELECT COUNT(*) AS total_employees
FROM employees
WHERE department = 'HR';
```

ðŸ“ _Counts how many employees belong to the HR department._

---

## ðŸ“Š **Detailed Explanation of Aggregate Functions**

### 1ï¸âƒ£ **COUNT() â€“ Count Rows**

Returns the number of rows or non-null values.

```sql
SELECT COUNT(*) AS total_records FROM employees;
```

ðŸ“ _Returns total number of rows in the table._

```sql
SELECT COUNT(department) AS dept_count FROM employees;
```

ðŸ“ _Counts only non-null department values._

---

### 2ï¸âƒ£ **SUM() â€“ Total Value**

Adds up all numeric values in a column.

```sql
SELECT SUM(salary) AS total_salary FROM employees;
```

ðŸ“ _Returns the total of all salaries._

---

### 3ï¸âƒ£ **AVG() â€“ Average Value**

Calculates the mean of numeric data.

```sql
SELECT AVG(salary) AS average_salary FROM employees;
```

ðŸ“ _Returns the average salary of all employees._

---

### 4ï¸âƒ£ **MIN() â€“ Minimum Value**

Finds the smallest value in a column.

```sql
SELECT MIN(age) AS youngest_employee FROM employees;
```

ðŸ“ _Finds the youngest employeeâ€™s age._

---

### 5ï¸âƒ£ **MAX() â€“ Maximum Value**

Finds the largest value in a column.

```sql
SELECT MAX(salary) AS highest_salary FROM employees;
```

ðŸ“ _Finds the highest salary in the company._

---

## ðŸ§© **GROUP BY Clause**

The **`GROUP BY`** clause is used to **group rows** that share the same value in one or more columns, so that aggregate functions can be applied to each group **separately**.

### ðŸ§¾ **Syntax:**

```sql
SELECT column_name, aggregate_function(column_name)
FROM table_name
GROUP BY column_name;
```

### ðŸ§  **Example:**

```sql
SELECT department, COUNT(*) AS total_employees
FROM employees
GROUP BY department;
```

ðŸ“ _Counts how many employees work in each department._

---

## ðŸ” **HAVING Clause**

The **`HAVING`** clause is used to **filter the results** of grouped data (after aggregation).
It works like a `WHERE` clause but is applied **after GROUP BY**.

### ðŸ§¾ **Syntax:**

```sql
SELECT column_name, aggregate_function(column_name)
FROM table_name
GROUP BY column_name
HAVING condition;
```

### ðŸ§  **Example:**

```sql
SELECT department, AVG(salary) AS avg_salary
FROM employees
GROUP BY department
HAVING AVG(salary) > 50000;
```

ðŸ“ _Shows departments where the average salary is greater than 50,000._

ðŸ§© **Note:**

-   Use `WHERE` to filter **rows before aggregation**.
-   Use `HAVING` to filter **groups after aggregation**.

---

## âš–ï¸ **Difference Between WHERE and HAVING**

| Basis                           | WHERE                        | HAVING                        |
| ------------------------------- | ---------------------------- | ----------------------------- |
| **Purpose**                     | Filters rows before grouping | Filters groups after grouping |
| **Used With**                   | Any SQL query                | Used with GROUP BY            |
| **Can Use Aggregate Functions** | âŒ No                        | âœ… Yes                        |
| **Example**                     | `WHERE salary > 40000`       | `HAVING AVG(salary) > 40000`  |

---

## ðŸ§© **Combined Example â€” Full Aggregate Query**

```sql
SELECT department, COUNT(*) AS total_employees, AVG(salary) AS avg_salary
FROM employees
WHERE department IS NOT NULL
GROUP BY department
HAVING AVG(salary) > 40000
ORDER BY avg_salary DESC;
```

### ðŸ” **Explanation:**

1. `WHERE department IS NOT NULL` â†’ filters out rows without a department.
2. `GROUP BY department` â†’ groups employees by department.
3. `COUNT(*)` and `AVG(salary)` â†’ calculate total and average per group.
4. `HAVING AVG(salary) > 40000` â†’ filters only those groups with high average salary.
5. `ORDER BY avg_salary DESC` â†’ sorts results by average salary (highest first).

ðŸ“ _This query shows each departmentâ€™s total employees and average salary, but only for departments with an average salary above â‚¹40,000._

---

## âœ… **Summary Table**

| Function / Clause | Description             | Example                      |
| ----------------- | ----------------------- | ---------------------------- |
| **COUNT()**       | Counts rows             | `COUNT(*)`                   |
| **SUM()**         | Adds values             | `SUM(salary)`                |
| **AVG()**         | Averages values         | `AVG(price)`                 |
| **MIN()**         | Finds smallest value    | `MIN(age)`                   |
| **MAX()**         | Finds largest value     | `MAX(salary)`                |
| **GROUP BY**      | Groups rows by column   | `GROUP BY department`        |
| **HAVING**        | Filters grouped results | `HAVING AVG(salary) > 40000` |

---

## ðŸ’¡ **Real-World Use Cases**

-   Generating **summary reports** (e.g., total sales per region).
-   Calculating **average marks or ratings** in education or review systems.
-   Finding **maximum or minimum prices** in product databases.
-   Counting **active users, transactions, or orders** per day or month.
-   Performing **financial and statistical analyses** using grouped summaries.
