## **What Are Pivot and Unpivot Operations?**

Pivoting and Unpivoting are **data transformation techniques** that help you reorganize how data is displayed or structured.

They are especially used in:

-   **Reporting and analytics**
-   **Data visualization tools (Power BI, Tableau)**
-   **ETL (Extract, Transform, Load) processes**

## ‚öôÔ∏è **1. PIVOT ‚Äî Converting Rows into Columns**

### üîç **Concept**

The **PIVOT** operation **rotates data** ‚Äî turning **unique row values into columns**.

You typically use it to:

-   Summarize data,
-   Create cross-tab reports,
-   Make datasets easier to read.

---

### üß† **Example Scenario**

Let‚Äôs say you have a table named `sales`:

| product | month | sales_amount |
| ------- | ----- | ------------ |
| Laptop  | Jan   | 5000         |
| Laptop  | Feb   | 6000         |
| Phone   | Jan   | 3000         |
| Phone   | Feb   | 4000         |

You want to **pivot** the data so that each **month becomes a column**, and the **sales_amount** is summarized for each product.

---

### ‚úÖ **Using `PIVOT` (SQL Server / Oracle Syntax)**

```sql
SELECT *
FROM (
    SELECT product, month, sales_amount
    FROM sales
) AS SourceTable
PIVOT (
    SUM(sales_amount)
    FOR month IN ([Jan], [Feb])
) AS PivotTable;
```

---

### üßæ **Result:**

| product | Jan  | Feb  |
| ------- | ---- | ---- |
| Laptop  | 5000 | 6000 |
| Phone   | 3000 | 4000 |

Now, each **month (Jan, Feb)** that was previously a _row value_ has become a _column header_.  
The **sales_amount** values are aggregated using `SUM()` for each month.

---

### üí° **General Syntax**

```sql
SELECT <non-pivoted column>, [column1], [column2], ...
FROM (
    SELECT <non-pivoted column>, <pivot column>, <value column>
    FROM table_name
) AS Source
PIVOT (
    <aggregate_function>(<value column>)
    FOR <pivot column> IN ([column1], [column2], ...)
) AS PivotTable;
```

---

### üß† **Alternative in MySQL (Since MySQL Has No PIVOT Keyword)**

You simulate PIVOT using **CASE** + **GROUP BY**:

```sql
SELECT
    product,
    SUM(CASE WHEN month = 'Jan' THEN sales_amount ELSE 0 END) AS Jan,
    SUM(CASE WHEN month = 'Feb' THEN sales_amount ELSE 0 END) AS Feb
FROM sales
GROUP BY product;
```

‚úÖ Same output as before!

---

### üß© **Use Cases for PIVOT**

| Use Case          | Example                |
| ----------------- | ---------------------- |
| Monthly reports   | Sales by month         |
| Yearly summaries  | Revenue by year        |
| Survey results    | Answers by category    |
| Financial reports | Expenses by department |

---

## üîÑ **2. UNPIVOT ‚Äî Converting Columns into Rows**

### üîç **Concept**

The **UNPIVOT** operation is the **reverse of PIVOT** ‚Äî  
it **transforms columns back into rows**.

You use UNPIVOT to:

-   Normalize data for relational storage,
-   Prepare wide tables for statistical analysis,
-   Restore pivoted data to its original structure.

---

### üß† **Example**

Let‚Äôs take the pivoted result from earlier:

| product | Jan  | Feb  |
| ------- | ---- | ---- |
| Laptop  | 5000 | 6000 |
| Phone   | 3000 | 4000 |

Now you want to **convert months (columns)** back into **rows** like before.

---

### ‚úÖ **Using `UNPIVOT` (SQL Server / Oracle Syntax)**

```sql
SELECT product, month, sales_amount
FROM (
    SELECT product, Jan, Feb
    FROM PivotTable
) AS SourceTable
UNPIVOT (
    sales_amount FOR month IN (Jan, Feb)
) AS UnpivotTable;
```

---

### üßæ **Result:**

| product | month | sales_amount |
| ------- | ----- | ------------ |
| Laptop  | Jan   | 5000         |
| Laptop  | Feb   | 6000         |
| Phone   | Jan   | 3000         |
| Phone   | Feb   | 4000         |

Perfect ‚Äî we‚Äôve reversed the pivot transformation!

---

### üß† **MySQL / PostgreSQL Alternative**

Since MySQL & PostgreSQL don‚Äôt have a native `UNPIVOT`,  
you use `UNION ALL`:

```sql
SELECT product, 'Jan' AS month, Jan AS sales_amount FROM PivotTable
UNION ALL
SELECT product, 'Feb' AS month, Feb AS sales_amount FROM PivotTable;
```

‚úÖ Same output.

---

## üßÆ **Key Differences Between PIVOT and UNPIVOT**

| Feature      | PIVOT                                        | UNPIVOT                                       |
| ------------ | -------------------------------------------- | --------------------------------------------- |
| Purpose      | Converts rows ‚Üí columns                      | Converts columns ‚Üí rows                       |
| Use Case     | Summarizing data for reports                 | Normalizing data for analysis                 |
| Operation    | Aggregates data (e.g., SUM, COUNT)           | De-aggregates data                            |
| Example      | Sales per month                              | Sales back to transaction level               |
| Availability | SQL Server, Oracle (native); MySQL uses CASE | SQL Server, Oracle (native); MySQL uses UNION |

---

## ‚öôÔ∏è **Performance Considerations**

-   **PIVOT** operations can be CPU-intensive if many rows or columns are involved.
-   Always **aggregate first**, then pivot to minimize data size.
-   When simulating pivot/unpivot in MySQL:
    -   Use **conditional aggregation** (`CASE`) for pivot.
    -   Use **`UNION ALL`** for unpivot ‚Äî avoid too many unions for performance.

---

## üß† **Real-World Use Cases**

| Domain              | Example                                                                                      |
| ------------------- | -------------------------------------------------------------------------------------------- |
| üìä Business Reports | Display monthly sales or profits per product                                                 |
| üè¶ Finance          | Turn expense categories into columns for easy comparison                                     |
| üß¨ Data Analytics   | Convert multiple measurement columns into a single column for machine learning preprocessing |
| üìã Surveys          | Summarize answers per question dynamically                                                   |
| üß± ETL Pipelines    | Normalize or denormalize data before loading into a warehouse                                |

---

## üí° **Summary**

| Operation              | Description                        | Common Use                       |
| ---------------------- | ---------------------------------- | -------------------------------- |
| **PIVOT**              | Converts rows to columns           | Create summary/cross-tab reports |
| **UNPIVOT**            | Converts columns to rows           | Normalize or flatten data        |
| **Aggregate Function** | Required in Pivot (SUM, AVG, etc.) | Not used in Unpivot              |
| **Supported In**       | SQL Server, Oracle                 | SQL Server, Oracle               |
| **MySQL Alternative**  | `CASE` + `GROUP BY`                | `UNION ALL`                      |
