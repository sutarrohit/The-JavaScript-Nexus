# ðŸ§  Understanding Context

When we say:

> _â€œA subquery can return a scalar, a column, a row, or a table.â€_

We are describing **the shape of the result** the subquery produces â€”
and therefore **how the outer query can use it.**

| Type       | Result shape                 | Typical use                  | Example clause                        |
| ---------- | ---------------------------- | ---------------------------- | ------------------------------------- |
| **Scalar** | One value (1 row Ã— 1 column) | Used in expressions          | `WHERE col = (SELECT MAX(...))`       |
| **Column** | One column (many rows)       | Used with `IN`, `ANY`, `ALL` | `WHERE col IN (SELECT col FROM ...)`  |
| **Row**    | One row (many columns)       | Used in tuple comparison     | `WHERE (a,b) = (SELECT x,y FROM ...)` |
| **Table**  | Many rows Ã— many columns     | Used in `FROM` clause        | `FROM (SELECT ... ) AS alias`         |

---

## ðŸ§© 1. **Scalar Subquery**

### ðŸ·ï¸ Definition

A **scalar** is a _single value_ â€” not a set or collection.
A **scalar subquery** is a query that returns exactly **one row and one column**.

Itâ€™s often used:

-   In `SELECT` lists (as a computed value)
-   In `WHERE` or `HAVING` clauses
-   In expressions or function arguments

---

### ðŸ§  Example 1 â€” in a `SELECT` clause:

```sql
SELECT
    name,
    salary,
    (SELECT AVG(salary) FROM CUSTOMERS) AS avg_salary
FROM CUSTOMERS;
```

**Explanation:**

-   The subquery `(SELECT AVG(salary) FROM CUSTOMERS)` returns a **single value** â€” the average salary.
-   That single scalar value is used for each row in the outer query.

âœ… Returns:

| name   | salary | avg_salary |
| ------ | -----: | ---------: |
| Ramesh |   2000 |       5500 |
| Khilan |   1500 |       5500 |
| ...    |    ... |        ... |

---

### ðŸ§  Example 2 â€” in a `WHERE` clause:

```sql
SELECT name, salary
FROM CUSTOMERS
WHERE salary > (SELECT AVG(salary) FROM CUSTOMERS);
```

**Explanation:**

-   The subquery returns _one numeric value_ (average salary).
-   The outer query compares each rowâ€™s salary against that single number.

âœ… This is the **most common scalar subquery** pattern.

---

### âš ï¸ Rules for Scalar Subqueries:

1. Must return **exactly one value** (one row Ã— one column).
2. If it returns **no rows**, it evaluates to `NULL`.
3. If it returns **multiple rows**, it throws an error.

---

## ðŸ“Š 2. **Column Subquery**

### ðŸ·ï¸ Definition

A **column subquery** returns **one column** and possibly **multiple rows**.
Itâ€™s used when you need to compare a value to a _list of values_.

---

### ðŸ§  Example â€” using `IN`:

```sql
SELECT *
FROM CUSTOMERS
WHERE id IN (
  SELECT id FROM CUSTOMERS_BKP WHERE salary > 5000
);
```

**Explanation:**

-   The inner subquery returns a **column** of IDs (one column, many rows).
-   The outer query checks if each `CUSTOMERS.id` is in that list.

âœ… The subquery result might look like:

```
id
---
4
5
7
```

And the outer query filters customers matching those IDs.

---

### ðŸ§  Example â€” using `ANY` and `ALL`:

```sql
SELECT name, salary
FROM CUSTOMERS
WHERE salary > ALL (
  SELECT salary FROM CUSTOMERS_BKP WHERE address = 'Mumbai'
);
```

**Meaning:**

-   The subquery gives _all salaries_ from Mumbai customers.
-   The outer query finds customers whose salary is greater than **every** salary in that list.

---

### âš™ï¸ Use Cases:

-   `IN` â€” check if value matches any in the column list
-   `ANY` / `SOME` â€” compare value against one or more results
-   `ALL` â€” compare value against every result in the column

---

## ðŸ§± 3. **Row Subquery**

### ðŸ·ï¸ Definition

A **row subquery** returns **exactly one row**, but possibly **multiple columns**.
Used when you want to compare **multiple values at once**.

---

### ðŸ§  Example â€” tuple comparison:

```sql
SELECT *
FROM CUSTOMERS
WHERE (age, salary) = (
    SELECT age, salary
    FROM CUSTOMERS_BKP
    WHERE name = 'Hardik'
);
```

**Explanation:**

-   The subquery returns one row with two columns: `(age, salary)` for Hardik.
-   The outer query looks for customers with the **same age and salary**.

âœ… Subquery result:

```
age | salary
----|--------
27  | 8500.00
```

Outer query checks `(age, salary) = (27, 8500.00)`.

---

### âš ï¸ Notes:

-   If the subquery returns more than one row â†’ error.
-   Useful when comparing **multiple column pairs**.

---

## ðŸ—ƒï¸ 4. **Table Subquery**

### ðŸ·ï¸ Definition

A **table subquery** returns a **complete set of rows and columns** (like a virtual table).
Itâ€™s typically used in the **FROM clause** â€” also known as an **inline view** or **derived table**.

---

### ðŸ§  Example â€” used in `FROM`:

```sql
SELECT city, avg_salary
FROM (
    SELECT address AS city, AVG(salary) AS avg_salary
    FROM CUSTOMERS
    GROUP BY address
) AS city_salaries
WHERE avg_salary > 5000;
```

**Explanation:**

-   The inner query (`SELECT address, AVG(salary) ...`) returns a **table** (multiple rows & columns).
-   The outer query treats that result as a **temporary table** (`city_salaries`) and filters it.

âœ… Subquery result (virtual table):

| city      | avg_salary |
| --------- | ---------: |
| Ahmedabad |       2000 |
| Mumbai    |       6500 |
| Bhopal    |       8500 |
| Indore    |      10000 |

Outer query then applies conditions on that table.

---

### ðŸ’¡ Alternate name:

**Inline View** = a table subquery in the `FROM` clause
It acts like a _temporary, in-memory table_ that exists only for the duration of the query.

---

## ðŸ” Comparison Summary

| Subquery Type | Returns            | Common Usage                  | Example                                   |
| ------------- | ------------------ | ----------------------------- | ----------------------------------------- |
| **Scalar**    | 1 row Ã— 1 column   | In expressions or comparisons | `WHERE salary > (SELECT AVG(salary) ...)` |
| **Column**    | N rows Ã— 1 column  | With `IN`, `ANY`, `ALL`       | `WHERE id IN (SELECT id ...)`             |
| **Row**       | 1 row Ã— N columns  | Multi-column comparisons      | `WHERE (a,b) = (SELECT x,y ...)`          |
| **Table**     | N rows Ã— M columns | Used in `FROM` clause         | `FROM (SELECT ... ) AS alias`             |

---

## ðŸ’¡ Practical Analogy

| Type       | Analogy                     | Description                         |
| ---------- | --------------------------- | ----------------------------------- |
| **Scalar** | One cell                    | Just one value (like a total count) |
| **Column** | One column of a spreadsheet | One field across many rows          |
| **Row**    | One complete record         | A single entry with many attributes |
| **Table**  | Whole spreadsheet           | Many records and fields together    |

---

## âœ… Quick Recap

-   **Scalar Subquery** â†’ one value (used in WHERE/SELECT).
-   **Column Subquery** â†’ one column, many values (used with IN/ANY/ALL).
-   **Row Subquery** â†’ one row, multiple columns (used in multi-column comparisons).
-   **Table Subquery** â†’ complete result set (used in FROM clause).
