## ðŸ§© **What is a Subquery?**

A **subquery** (also known as a **nested query** or **inner query**) is a query **inside another SQL query**.
The **outer query** uses the result of the **inner query** to perform operations like filtering, inserting, updating, or deleting.

Think of it like this:

> ðŸŽ¯ â€œA query inside a query.â€

### ðŸ“˜ Example:

```sql
SELECT *
FROM employees
WHERE department_id IN (
    SELECT id FROM departments WHERE location = 'Delhi'
);
```

Here:

-   Inner Query â†’ `(SELECT id FROM departments WHERE location = 'Delhi')`
-   Outer Query â†’ `SELECT * FROM employees ...`

The **inner query** runs first, and its output is used by the **outer query**.

---

## âš™ï¸ **Types of Subqueries**

| Type                        | Description                          | Returns                            |
| --------------------------- | ------------------------------------ | ---------------------------------- |
| **Scalar Subquery**         | Returns a single value               | One value (e.g., number or string) |
| **Row Subquery**            | Returns a single row                 | One row (multiple columns)         |
| **Table Subquery**          | Returns multiple rows and columns    | Table-like result                  |
| **Correlated Subquery**     | Refers to columns in the outer query | Depends on outer query             |
| **Non-Correlated Subquery** | Can run independently                | Does not depend on outer query     |

---

## ðŸ§± **Rules for Writing Subqueries**

1. Must be enclosed in **parentheses** `( )`.
2. Must contain a **SELECT** statement.
3. Can be nested within another subquery.
4. Cannot use `ORDER BY` unless used with `TOP` or `LIMIT`.
5. Can return:

    - A single value
    - A single row
    - A single column
    - Or an entire result set

---

## ðŸ” **1. Subquery with SELECT**

Used to filter or compare data inside a `WHERE` clause.

```sql
SELECT *
FROM CUSTOMERS
WHERE ID IN (
  SELECT ID FROM CUSTOMERS WHERE SALARY > 4500
);
```

### ðŸ“Š Output:

| ID  | NAME     | AGE | ADDRESS | SALARY   |
| --- | -------- | --- | ------- | -------- |
| 4   | Chaitali | 25  | Mumbai  | 6500.00  |
| 5   | Hardik   | 27  | Bhopal  | 8500.00  |
| 7   | Muffy    | 24  | Indore  | 10000.00 |

**Explanation:**

-   Inner query selects IDs where salary > 4500.
-   Outer query returns customer details for those IDs.

---

## ðŸª£ **2. Subquery with INSERT**

Used to copy data from one table to another.

```sql
INSERT INTO CUSTOMERS_BKP
SELECT * FROM CUSTOMERS
WHERE ID IN (SELECT ID FROM CUSTOMERS);
```

âœ… **Result:**
All records from `CUSTOMERS` are copied to `CUSTOMERS_BKP`.

---

## âœï¸ **3. Subquery with UPDATE**

Used to update specific rows based on another queryâ€™s result.

```sql
UPDATE CUSTOMERS
SET SALARY = SALARY * 0.25
WHERE AGE IN (SELECT AGE FROM CUSTOMERS_BKP WHERE AGE >= 27);
```

âœ… **Result:**
Updates salary for customers whose age â‰¥ 27.

| ID  | NAME   | AGE | SALARY  |
| --- | ------ | --- | ------- |
| 1   | Ramesh | 32  | 500.00  |
| 5   | Hardik | 27  | 2125.00 |

---

## ðŸ—‘ï¸ **4. Subquery with DELETE**

Used to delete records conditionally based on another table.

```sql
DELETE FROM CUSTOMERS
WHERE AGE IN (SELECT AGE FROM CUSTOMERS_BKP WHERE AGE >= 27);
```

âœ… **Result:**
Deletes customers aged 27 or above.

| ID  | NAME     | AGE | SALARY   |
| --- | -------- | --- | -------- |
| 2   | Khilan   | 25  | 1500.00  |
| 3   | Kaushik  | 23  | 2000.00  |
| 4   | Chaitali | 25  | 6500.00  |
| 6   | Komal    | 22  | 4500.00  |
| 7   | Muffy    | 24  | 10000.00 |

---

## ðŸ”„ **Correlated vs Non-Correlated Subquery**

### ðŸ§  Non-Correlated Subquery

Independent â€” runs first, and result is passed to the outer query.

```sql
SELECT * FROM CUSTOMERS
WHERE SALARY > (SELECT AVG(SALARY) FROM CUSTOMERS);
```

â†’ Finds customers earning above average salary.

---

### ðŸ” Correlated Subquery

Depends on outer query â€” runs **once for each row** of the outer query.

```sql
SELECT NAME, SALARY
FROM CUSTOMERS c1
WHERE SALARY > (
  SELECT AVG(SALARY) FROM CUSTOMERS c2 WHERE c1.AGE = c2.AGE
);
```

â†’ Compares each customer's salary with the **average salary of their age group**.

---

## ðŸ§® **Subqueries in the FROM Clause (Inline Views)**

You can also use subqueries as temporary tables:

```sql
SELECT AVG(SALARY) AS avg_salary
FROM (
  SELECT * FROM CUSTOMERS WHERE AGE < 30
) AS young_customers;
```

Here, the inner query creates a temporary view (`young_customers`).

---

## ðŸ§  Summary Table

| SQL Statement | Use of Subquery      | Example                                |
| ------------- | -------------------- | -------------------------------------- |
| **SELECT**    | Filter data          | `WHERE col IN (SELECT ...)`            |
| **INSERT**    | Copy data            | `INSERT INTO ... SELECT ...`           |
| **UPDATE**    | Modify conditionally | `UPDATE ... WHERE col IN (SELECT ...)` |
| **DELETE**    | Remove conditionally | `DELETE ... WHERE col IN (SELECT ...)` |
