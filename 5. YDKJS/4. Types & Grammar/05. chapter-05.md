# Chapter 5: Grammar

## 1. Statements & Expressions

### Expressions

-   **Expression**: something that produces a value.

    ```js
    3 + 4; // expression → 7
    foo(); // expression → result of foo
    a = 42; // expression → 42
    ```

-   Expressions can appear **anywhere a value is expected**:
    ```js
    console.log((a = 42)); // 42
    ```

### Statements

-   **Statement**: performs an action (may contain expressions).
    ```js
    var a = 42;   // statement
    if (a) { ... } // statement
    ```

Key difference:

-   Expression → produces a value.
-   Statement → controls execution / program flow.

### Expression Statements

-   Some expressions stand alone as **statements**:
    ```js
    a = 42; // assignment expression as a statement
    foo(); // function call expression as a statement
    ```

### Block Statements

-   Curly braces `{}` group multiple statements into one block.
    ```js
    {
        var a = 42;
        console.log(a);
    }
    ```

### Expressions vs Statements Confusion

-   **Function declarations vs function expressions**

    ```js
    // Declaration (statement)
    function foo() {
        return 42;
    }

    // Expression
    var bar = function () {
        return 42;
    };
    ```

-   Function declaration is **hoisted**, function expression is not.

---

## 2. Operator Precedence

-   **Operator precedence** determines which operator executes first.
-   Example:

    ```js
    var a = 3 + 4 * 5; // 3 + (4 * 5) = 23
    ```

-   Multiplication/division > addition/subtraction.

### Associativity

-   When operators have the same precedence, **associativity** decides the order:
    -   **Left-associative** (default): `a + b + c` → `(a + b) + c`
    -   **Right-associative**: assignments, exponentiation (`**`).
        ```js
        var a = (b = c = 42); // (a = (b = (c = 42)))
        ```

Always use parentheses `()` to make precedence clear.

---

## 3. Automatic Semicolon Insertion (ASI)

-   JS **inserts semicolons automatically** in certain cases.
-   Example:
    ```js
    var a = 42;
    console.log(a);
    ```
    → JS interprets as:
    ```js
    var a = 42;
    console.log(a);
    ```

### ASI Pitfalls

-   When line breaks are misleading:

    ```js
    return;
    {
        a: 42;
    }
    ```

    → Interpreted as:

    ```js
    return; // undefined
    {
        a: 42;
    }
    ```

-   With `++` or `--`:
    ```js
    a;
    ++b;
    ```
    → Interpreted as:
    ```js
    a;
    ++b;
    ```

Best practice: **always use semicolons** to avoid ASI surprises.

---

## 4. Errors

### Types of Errors

-   **Syntax Error**: invalid code structure.

    ```js
    var a = ;
    ```

-   **TypeError**: invalid operation on a value.

    ```js
    null.f(); // TypeError
    ```

-   **ReferenceError**: using undeclared variable.
    ```js
    console.log(x); // ReferenceError
    ```

Some runtime errors can be caught with `try..catch`.

---

## 5. Function Arguments

### Extra Arguments

-   JS does not enforce number of arguments.
    ```js
    function foo(a, b) {
        console.log(a, b);
    }
    foo(1); // 1 undefined
    foo(1, 2, 3); // 1 2
    ```

### Default Values

-   ES5:
    ```js
    function foo(a) {
        a = a || 42; // fallback
        console.log(a);
    }
    foo(); // 42
    ```
-   ES6:
    ```js
    function foo(a = 42) {
        console.log(a);
    }
    foo(); // 42
    ```

### `arguments` Object

-   Array-like object of all passed arguments.
    ```js
    function foo(a, b) {
        console.log(arguments.length); // number of passed args
        console.log(arguments[0]); // first arg
    }
    foo(1, 2, 3);
    ```
-   **Deprecated in ES6** in favor of rest parameters:
    ```js
    function bar(...args) {
        console.log(args);
    }
    ```

---

## 6. try..finally

-   `finally` always runs, regardless of error/return.

    ```js
    function foo() {
        try {
            return 42;
        } finally {
            console.log("cleanup runs");
        }
    }
    foo(); // cleanup runs → 42
    ```

-   Even if `try` has `return`, `finally` executes first.

---

## 7. switch

-   Matches value against multiple cases.
    ```js
    switch (x) {
        case 1:
            console.log("one");
            break;
        case 2:
            console.log("two");
            break;
        default:
            console.log("other");
    }
    ```

### Fall-through

-   Without `break`, execution continues:

    ```js
    switch (a) {
        case 1:
        case 2:
            console.log("one or two");
            break;
    }
    ```

-   Can be used intentionally for grouping, but often a source of bugs.

---

## 8. Review

-   **Expressions vs Statements**: Expressions produce values, statements control flow.
-   **Operator precedence**: defines order of evaluation. Use parentheses to be clear.
-   **ASI (Automatic Semicolon Insertion)**: can cause subtle bugs → always use semicolons.
-   **Errors**: SyntaxError (compile), TypeError/ReferenceError (runtime).
-   **Function arguments**: flexible in JS, extra/less args allowed. Use default values and rest params.
-   **try..finally**: cleanup always runs.
-   **switch**: use `break` to avoid fall-through unless intentional.
